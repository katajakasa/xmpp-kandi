\documentclass[finnish,nonumbib,nocopyright,shortthesis]{gradu2}

\usepackage{palatino}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[finnish]{babel}
\usepackage{ae,aecompl}
\addto\captionsfinnish{\def\refname{Lähteet}}
\usepackage[pdftex]{graphicx}

\title{XMPP-pikaviestinprotokolla}
\setauthor{Tuomas}{Virtanen}
\yhteystiedot{tuomas.virtanen@jyu.fi}
\translatedtitle{XMPP-Protocol}
\abstract{XMPP is a versatile and extensible instant messaging protocol based on open standards. It can be
used for eg. sending text messages and presence information, VoIP-calls and file transfers. This thesis 
examines the technical aspects of the protocol, and makes comparisons to other instant messaging protocols.}
\tiivistelma{XMPP on monipuolinen ja laajennettavissa oleva, avoimiin standardeihin perustuva pikaviestinprotokolla. 
Sitä voidaan käyttää paitsi puhtaiden tekstiviestien lähettämiseen ja olotilan tarkkailuun, myös 
esimerkiksi tiedostonsiirtoihin ja VoIP-puheluihin. Tässä tutkielmassa tutustutaan protokollan 
teknisiin ominaisuuksiin ja tehdään vertailuja muihin pikaviestinprotokolliin.}
\keywords{XMPP, Protocol, instant messaging}
\avainsanat{XMPP, protokolla, pikaviestintä}
\setdate{31}{10}{2011}
\tyyppi{kandidaatintutkielma}

\begin{document}

\mainmatter

\section{Johdanto}

Pikaviestinnästä on tullut osa useiden tietokoneen, ja vähitellen myös erilaisten mobiililaitteiden 
käyttäjien arkea. Pikaviestintää käytetään niin kotona, koulussa ja töissä. Erilaisia pikaviestin-ohjelmia 
on useita, ja viestintää voidaan harrastaa joko perinteisesti tekstiviestein, tai monipuolisemmin äänen ja 
videon avulla. WWW-ohjelmointitekniikoiden edistyessä pikaviestimiä löytyy jopa erilaisilta www-sivuilta, josta
hyvänä esimerkkinä toimii mm. Facebook-palvelu.

Erilaisten pikaviestinsovellusten tullessa markkinoille, syntyy myös uusia viestintäprotokollia ja määritelmiä
näiden sovellusten käyttöön. Tästä johtuukin nykymallin mukaisen pikaviestinnän suurin ongelma; eri pikaviestinverkkoihin
tarvitaan usein eri ohjelmat. Samalla käyttäjällä saattaakin olla käytössä useita ohjelmia, jotka toimivat omissa
viestintäverkoissaan. Yrityksiä yhdistää eri pikaviestinverkkoja saman ohjelman käyttöön on olemassa, mutta
kaikki näistä ovat eri syistä epätäydellisiä.

Usein ongelmana pikaviestintäprotokollien toteuttamisessa on se, että pikaviestinverkon protokolla on jollain 
tavalla suljettu. Protokolla voi olla suljettu esimerkiksi lisenssiehdoiltaan, joilla sen käyttöä rajoitetaan muiden 
kuin sille suunnitellun ohjelman käyttöön. Protokollan määritelmä voi olla suljettu ja itse protokolla voi olla salattu jollain
salausalgoritmilla. Esimerkiksi MSN Messenger-ohjelman käyttämän MSNP-protokollan määritelmä ei ole julkinen. 
Skype-pikaviestinohjelman käyttämä protokolla taas on täysin salattu~\cite{skype1} Rijndael-algoritmilla. Tällaisten ohjelmien 
käyttämiä protokollia ei voida toteuttaa muihin pikaviestimiin ilman protokollan purkua, joka esimerkiksi Skypen tapauksessa
on toistaiseksi ollut vain osittain menestyksekästä.

TODO! Lähde skypen suojauksen murtamiselle, tästä oli slashdotissa keskustelua jokin aika sitten.

Extensible Messaging and Presence Protocol (XMPP) pyrkii olemaan mahdollisimman avoin ja laajennettavissa oleva,
yleiskäyttöinen protokolla kaikkeen pikaviestintään. Se hallitsee laajennuksia käyttäen mm. tekstiviestit, 
VoIP-puhelut sekä tiedostojen siirron käyttäjien välillä. XMPP-verkko sallii myös esimerkiksi siltaukset
muihin pikaviestinverkkoihin, kuten Internet Relay Chat (IRC). XMPP-protokollaa käyttääkin nykyään jo moni
tunnettu yritys sovelluksissaan, kuten mm. Nokia (Nokia Ovi), Google (Google Talk, Google Wave), 
LiveJournal (LJ Talk). Myös muunmuassa Facebook paljastaa XMPP-pohjaisen rajapinnan palvelun ulkopuolisille
käyttäjille.

Kandidaatintutkielma tarkastelee lyhyesti pikaviestintää, ja keskittyy erityisesti XMPP-pikaviestinprotokollaan.
Luvussa 2 käsitellään pikaviestintää yleisesti, ja esitellään muutamia sen sovelluksia sekä protokollia.
Luvussa 3 esitellään XMPP-protokollaa ja sen rakennetta. Luvussa 4 perehdytään XMPP-verkkoihin ja niiden 
eroihin muihin pikaviestinverkkoihin nähden. Luvussa 5 esitellään XMPP-protokollan pikaviestintään tarjoamia
ominaisuuksia, kuten tekstiviestejä ja olotilan hallintaa.

(Lähteet käyttäville yrityksille/sovelluksille)

\section{Pikaviestintä ja sen protokollat}
\subsection{Pikaviestinnän käsitteitä}

Pikaviestinnässä on Wikipedian määritelmän~\cite{wiki1} mukaan kyse (lähes) reaaliaikaisesta, tekstipohjaisesta 
viestinnästä kahden tai useamman ihmisen välillä tietokoneiden tai muiden laitteiden välityksellä. Tiedon siirto tapahtuu
Internetin tai muun verkon yli. Pikaviestintä voi monipuolisimmillaan olla myös videon tai äänen välityksellä tapahtuvaa 
viestintää.

\subsection{Pikaviestinnän sovellukset}

Pikaviestintää käytetään nykyään moneen eri tarkoitukseen. Tunnetuinta pikaviestintä on luultavasti nuorison keskuudessa,
jotka ovat jo pitkään käyttäneet erilaisia ohjelmia sosiaalisten ryhmiensä väliseen viestintään. Nuorison keskuudessa
suosituimpia sovelluksia nykyään ovat muunmuassa facebook, MSN Messenger, Skype sekä tavallinen tekstiviestintä. Myös muita
ohjelmia käytetään.

Työpaikoilla pikaviestintää käytetään useing projektien koordinointiin eri työryhmien välillä sekä viestintään asiakkaiden
kanssa. Pikaviestinnän tärkeimpiä osa-alueita näissä käyttötarkoituksissa ovatkin esimerkiksi puhe- sekä videopohjainen
pikaviestintä.

(Muista lisätä lähde näille!)

\section{XMPP-Protokolla}

Extensible Messaging and Presence Protocol (XMPP) on avoin, reaaliaikaiseen pikaviestintään ja olotilan ilmoittamiseen 
tarkoitettu XML-pohjainen standardi. Protokollaa kehittiin alun perin nimellä Jabber, ja se oli tarkoitettu saman 
nimiseen, vapaaseen lähdekoodiin perustuvaan pikaviestinohjelmaan. Vuonna 2002 perustettiin XMPP työryhmä (XMPP WG), 
jonka tehtäväksi tuli Jabber-protokollaan perustuvan pikaviestinprotokollan kehitys. Uuden, XMPP-nimisen protokollan 
tarkoitus oli soveltua Internet Engineering Task Forcen (IETF) tukemaksi pikaviestintä- ja olotilan hallinta-protokollaksi. 
Kehitystyön tuloksena oli lopulta dokumentti, jossa määriteltiin protokollan perusominaisuudet ja laajennukset pikaviestintään.
Nykyään tätä perustoiminnallisuutta määritellään RFC-dokumenteissa 3920 ja 3921. Myöhemmin protokollaan on luotu laajennuksia 
esimerkiksi tiedostojen siirtämiseen sekä VoIP-puheluihin. 

\subsection{Versiot ja ydinstandardi}

XMPP-protokollan kehityksen voidaan katsoa alkaneen vuonna 2000, jolloin julkaistiin XMPP:n edeltäjän, IMPP:n suunnitelma. 
Tämän jälkeen julkistettiin seuraavina vuosina useita suunnitelmadokumentteja muunmuassa salauksen soveltamisesta
pikaviestintään, merkkijonojen kuljettamisesta XML-virroissa sekä olotilan julkistamisesta.

Protokollan ensimmäinen virallinen määritelmä julkaistiin vuonna 2004 RFC-dokumenteissa 3920 - 3923. Seuraavien vuosien
aikana kehiteltiin useita laajennuksia mm. puheen ja videokuvan kuljettamiseen XMPP-verkossa, kunnes vuonna 2011 julkaistiin
protokollan seuraava versio RFC-dokumenteissa 6120 - 6122. Uusimmat määritelmädokumentit ovat käytännössä vielä
tarkastelun alla. Tässä dokumentissa käsitelläänkin protokollaa vielä vanhemman, käytetymmän ja tuetumman version pohjalta.

(Tämän voisi sanailla paremmin, yhdistää edellisen kanssa ?)

\subsection{XML-tietovirrat}

XMPP-standardissa liikenne kuljetetaan yleensä XML-tietovirrassa.
XML-tietovirtaa voidaan ajatella säiliönä, jota käytetään XML-elementtien kuljettamiseen verkkoentiteettien välillä. 
Virran alku ilmoitetaan aina XML-tagilla "<stream>", jossa voidaan määritellä attribuutteina myös esimerkiksi käytettävä 
nimiavaruus ja nerkistö. Virran loppua merkkaa vastakkaisesti tagi "</stream>". Niin kauan kuin XML-virta 
on olemassa, sen luonut entiteetti voi lähettää määrittämättömän määrän XML-elementtejä vastaanottajalle. XML-tietovirta 
on aina yksisuuntainen; mikäli vastaanottava pää haluaa lähettää viestejä, pitää sen tätä varten erikseen neuvotella 
erillinen virta (Response Stream).

XML-tietovirrassa voidaan lähettää XMPP-standardin mukaan lähettää joko XML-säkeistöjä tai yhteyden neuvottelemiseen
tarvittavia XML-elementtejä. Mikäli entiteetti saa vääränmuotoisen paketin, se hylätään. Yhteyden ja 
virran neuvottelee yleensä asiakas- tai palvelinentiteetti vastaanottavaan entiteettiin, joka on yleensä palvelin. 
Asiakas-palvelin yhteyksien lisäksi siis palvelin-palvelin yhteydet ovat myös mahdollisia.

\subsection{Säkeistöt}

XMPP-protokollassa säkeistö (Stanza) on itsenäinen tietopaketti, joka voidaan lähettää entiteetiltä toiselle XML-virran yli. 
Säkeistö kuljetetaan aina suoraan XML-virran stream-juurielementin alla, ja voi olla nimeltään "message", "presence" tai "iq".
Säkeistöjen nimiavaruuden on oltava "jabber:client" tai "jabber:server". Mikä tahansa muu tietovirrassa lähetetty paketti
ei ole säkeistö. Säkeistö sisältää yleensä yhden tai useampia lapsielementtejä.

Stanzalla on kolme tyyppiä, joilla määritetään viestintämekanismi. "Push"-mekanismi on tarkoitettu yleiseen viestintään,
"publish-subscribe" yleiseen palvelimen ja verkon tilan viestittämiseen asiakkaille, ja "request-response" taas tiedon 
vaihtamiseen entiteettien kesken. "iq"-tyyppinen paketti on tyypiltään "request-response", kun taas presence ja message-elementit
ovat "push"-tyyppisiä.

\section{Verkko}

XMPP-verkko on hajautettu, ja palvelimia voi olla useita. Palvelimet voivat olla yhteydessä toisiinsa
suoraan, tai välipalvelimien välityksellä. Asiakkaat voivat halutessaan ottaa yhteyden mihin tahansa verkon
palvelimista.

\begin{figure}[htp]
	\centering
	\includegraphics[width=0.9\textwidth]{verkkokuva.png}
	\caption{XMPP-verkon rakenne} 
	\label{verkkokuva}
\end{figure}

\subsection{Palvelin}

Vaikka XMPP:n määritelmässä ei varsinaisesti määritellä miten viestejä lähetetään, 
käytetään protokollaa yleensä asiakas-palvelin-arkkitehtuurilla. Erona useisiin muihin 
tunnettuihin pikaviestinprotokolliin, kuten OSCAR ja MSNP on kuitenkin se, että XMPP-verkolla ei ole 
yhtä keskitettyä autentikaatiopalvelinta. Käytännössä siis kuka tahansa voi ajaa omaa palvelintaan, ja 
liittää sen osaksi suurempaa verkkoa.

Palvelimen tehtävänä XMPP-verkossa on TCP-yhteyksien vastaanotto sekä liikenteen välittäminen 
muille autentikoiduille käyttäjille, palvelimille ja muille kohteille. Palvelin myös reitittää 
asiakkaan lähettämät paketit oikeisiin kohteisiin. Palvelimet voivat myös tallentaa käyttäjäkohtaisia 
tietoja, kuten kontaktilistan, joka voi sisältää muita käyttäjiä mistä tahansa liitetystä XMPP-verkosta.

\subsection{Asiakas}

Asiakas luo yhteyden palvelimeen TCP-protokollan yli tiettyyn palvelimen porttiin. Internet Assigned Numbers 
Authority (IANA) on määritellyt XMPP-protokollan käyttöön portin 5222, mutta muitakin saattaa olla käytössä. 
Asiakkaan tehtävänä on lähettää viestejä ja tilatietoja palvelimelle, sekä vastaanottaa niitä palvelimelta. 
Asiakkaan on osattava vähintään avata yhteys XML-viestien lähettämistä ja vastaanottamista varten.

XMPP-verkossa jokaista asiakasta tai päätepistettä kutsutaan entiteetiksi, jolla on aina oma tunnisteensa 
nimeltään JID. Tunniste on kolmiosainen, esimerkiksi muotoa "<solmu@toimialue/resurssi>". Tunnisteessa 
toimialue-kenttä määrittelee käytetyn palvelimen osoitteen, "solmu"-kenttä käyttäjän nimen ja "resurssi"-kenttä
käyttäjälle kuuluvan toisen asiakaslaitteen. Protokolla salliikin useampien asiakasohjelmien kirjautumisen 
samalle palvelimelle samalla käyttäjätunnuksella, kunhan eri ohjelmille määritellään oma kotiosoitteensa. 

Entiteeteille voidaan määrittää myös tärkeystasoja, jolloin esimerkiksi osoitteeseen "<solmu@toimialue/matkapuhelin>" 
lähetetty viesti menee käyttäjän matkapuhelimeen, mutta osoitteeseen "<solmu@toimialue>" lähetetty viesti ohjautuu 
tärkeimmäksi määriteltyyn asiakasohjelmaan tai laitteeseen.

\subsection{Välipalvelin}

Koska XMPP-sallii useampien palvelinten toimimisen yhdessä, voidaan XMPP-verkkoa laajentaa niinsanotuilla 
välipalvelimilla (Gateway). Välipalvelimen tehtävänä on muuntaa XMPP-viestejä sopivaksi välipalvelimen 
toisella puolella toimivaan pikaviestinverkkoon, ja toisaalta toisesta verkosta tulevia viestejä XMPP-verkkoon 
sopiviksi. Tunnettuja välipalvelimia on olemassa esimerkiksi SMTP, Internet Relay Chat, SIMPLE sekä SMS -verkkoja varten. 

Suurimpana ongelmana välipalvelinten käytössä on se, että protokollat eivät aina ole täysin yhteensopivia. Tästä 
seuraa, että osa viesteissä välitetystä tiedosta ei välttämättä ole esitettävissä toisella protokollalla. Ongelmia tulee
myös turvallisuuden kanssa, sillä lähetetyn viestin tai muun tiedon siirtyessä toiseen pikaviestinverkkoon, sen
turvallisuutta ei voida enää taata.

\subsection{Yhteyden suojaus}

XMPP-verkon kaikkien asiakkaiden ja palvelinten on tuettava TLS- ja SASL-metodeja tiedon salaamiseen. Salauksen käyttö
ei ole protokollan määritelmädokumentissa vaadittua, mutta sitä suositellaan vahvasti. Myös palvelinten välisten
tietoliikenneyhteyksien välinen salaus on suositeltua, muttei vaadittua.

XMPP-verkossa määritellään myös palvelinten välinen "server dialback" eli takaisinsoitto, jota voidaan käyttää
varmistamaan että palvelimeen yhdistävä toinen palvelin on olemassa. Protokollan määritelmädokumenteissa
takaisinsoitto määritelläänkin hyvin heikoksi suojaukseksi, ja sen käyttöä ei enää suositella. Palvelinten 
ei odoteta enää tukevan kyseistä metodia.

\section{XMPP-protokollan toteutus}

XMPP-protokollan ydinmääritelmä on hyvin yksinkertainen. Ytimessä ei määritellä esimerkiksi pikaviestintää tai
tilanhallintaa. Sen sijaan pikaviestintä, tilanhallinta, puheviestintä sekä esimerkiksi videon ja tiedostojen välitys
ovat laajennuksia. Laajennukset määritellään tarkemmin 

\subsection{Asiakkaan autentikointi}

XMPP-protokollan mukainen yhteys asiakas- ja palvelinsovelluksen välillä aloitetaan luomalla XML-virta. 
Ensimmäiseksi virrassa suoritetaan mahdollinen salauksen neuvottelu sopivin xml-säkein. Salauksen epäonnistuessa
palvelinsovellus voi vastata erilaisilla virheilmoituksilla. (TODO: Lähde)

Kun haluttu yhteyden salauksen neuvottelu on suoritettu, aloitetaan virallinen yhteys lähettämällä 
protokollamääritelmän mukainen stream-elementti. Palvelin vastaa elementtiin omalla "stream"-elementillään
sekä "stream:features"-elementillä, jossa määritellään autentikointiin käytettävät suojausmetodit.
Tavallisesti käytässä on ainakin MD5-tiivistealgoritmi sekä puhdas teksti. Asiakasohjelma valitsee
suojausmetodin, ja ilmoittaa siitä "auth"-elementissä palvelimelle.

Kun autentikaatiometodin valinta on suoritettu onnistuneesti, aloitetaan itse autentikaatio. Kaikki autentikaatiopaketit
kuljetetaan asiakkaan ja palvelimen välillä "response" ja "challenge"-paketeissa base64-enkoodattuna. Virhetilanteessa
palvelin voi lähettää myös "failure"-elementin virhetietojen kera. Lähetettävät elementit riippuvat valitusta 
autentikaatiometodista. Kun asiakas on vastannut oikein kaikkiin palvelimen lähettämiin haasteisiin, saa asiakas
palvelimelta "success"-elementin. Tämän jälkeen asiakas neuvottelee palvelimenkanssa uuden yhteyden "stream"-elementeillä,
ja palvelin lähettää asiakkaalle listan palvelimen osaamista toiminnoista "stream:features"-elementissä. Näitä voi olla
mm. sessionhallinta, pikaviestintä ja resurssien sidonta.

\subsection{Sessio ja resurssin sidonta}

Kun yhteys on luotu ja autentikointi on suoritettu, suoritetaan käyttäjän resurssin sidonta palvelimelle. Sidonta on tarpeellista,
mikäli palvelin aiemmassa vaiheessa ilmoitti sen ominaisuutena asiakkaalle. Sidonnan tarkoituksena on yhdistää asiakkaan resurssi, 
esim. "kotikone" tai "kannettava" palvelimella toimivaksi JID-tunnisteeksi. Tätä varten asiakas lähettää heti autentikoinnin 
onnistuttua palvelimelle iq-säkeen, jossa lähetetään sen sisäisessä "resource"-elementissä haluttu resurssi. Asiakas voi antaa
myös palvelimen suorittaa resurssinimen valinnan automaattisesti jättämällä kentän ryhjäksi. Palvelimen ei myöskään ole pakko
hyväksyä haluttua resurssia, vaan voi vaihtaa sen toiseen. Resurssin sidonnan onnistuttua palvelin lähettää asiakkaalle iq-säkeen,
jonka sisäisessä "jid"-elementissä on asiakkaan täysi JID-tunniste. Tätä tunnistetta käytetään asiakkaan tunnistamiseen palvelimella
loppuyhteyden aikana.

Mikäli palvelin mainostaa asiakkaalle "stream:features"-elementissä sessio-ominaisuutta, ja mikäli asiakasohjelma haluaa
käyttää palvelimen pikaviestintä- ja tilanhallintaominaisuuksia, on asiakkaan neuvoteltava palvelimen kanssa sessio. Tämä tehdään
lähettämällä palvelimelle sopiva iq-säe. Palvelin vastaa tähän joko onnistumista merkkaavalla tyhjällä iq-säkeellä, 
tai "error"-elementillä varustetulla virhettä merkkaavalla iq-säkeellä. Mikäli session luonti epäonnistuu, voi se olla merkki
siitä, että asiakkaalla ei ole oikeuksia pikaviestintään palvelimella. Kun session luonti on suoritettu, sanotaan
resurssin XMPP-terminologiassa olevan aktiivinen.

\begin{verbatim}
tähän esimerkki paketeista (vaiko Liitteeseen ?)
\end{verbatim}

\subsection{Tekstiviestien välitys}

Viestien lähetystä varten asiakkaalla on oltava täysi JID. Viestipakettina käytetään message-säettä, jolla on oltava
aina vähintään "to"-parametri viestin vastaanottajan JID:tä varten. Vastaanottajan JID voi sisältää resurssin, mikäli viesti
on suunnattu vastaanottajan tietylle resurssille. Mikäli resurssia ei määritetä, suuntautuu viesti vastaanottajan
kaikkiin resursseihin. Elementissä voidaan määritellä myös "from"-parametri, johon sijoitetaan viestin lähettäjän JID.
Mikäli lähettäjän JID sisältää resurssinimen, suunnataan takaisin tulevat viestit tähän resurssiin.

Message-säe sisältää aina "body"-elementin, jossa on kuljetettava viesti. Viestin pituudelle ei teoriassa ole määritetty rajaa,
mutta asiakasohjelmat saattavat itse lyhentää viestiä. Säe voi sisältää myös "thread"-elementin, jolla ilmoitetaan keskustelu,
johon viesti liittyy. Mikäli viestiin tai keskusteluun halutaan määrittää aihe, se voidaan lähettää "subject"-elementissä. Kun
säe on rakennettu, se voidaan lähettää palvelimelle, ja palvelin hoitaa säkeen siirron oikealle vastaanottajalle.

\subsection{Ystävälistan hallinta}

Ystävälista pitää sisällään tiedot käyttäjän listalle lisäämistä JID-kontakteista. Ystävälistan säilytystä hallitsee palvelin,
ja asiakas voi pyytää sen erikseen palvelimelta. Ystävälistalle voidaan lisätä käyttäjiä vain, mikäli lisäyksen kohde sallii sen.
Ystäväpyyntöä kutsutaan XMPP-terminologiassa tilaukseksi ("subscription"). Asiakas suorittaa tilauksen lähettämällä palvelimelle
sisällöttömän presence-säkeen, jonka "type"-parametrina on "subscribe" ja "to"-parametrina lisäyksen kohteen JID ilman resurssia.
Vastaanottaja vastaa tähän lähettämällä vastaavan paketin, jonka "type"-parametrina on joko "subscribed" (tilattu) tai 
"unsubscribed" (ei tilattu).

\begin{figure}[htp]
	\centering
	\includegraphics[scale=0.7]{kaverilista.png}
	\caption{Tyypillinen kontaktilista pikaviestinohjelmassa} 
	\label{kontaktilista}
\end{figure}

\subsection{Tilatiedot}

Asiakas voi lähettää ystävälistallaan oleville käyttäjille tietoja omasta tilastaan, 
esimerkiksi "poissa" tai "älä häiritse". Asiakas lähettää tilanvaihtopyynnön palvelimelle, joka hoitaa sen eteenpäin ystävälistan 
kaikille kontakteille. Mikäli asiakas ei viestitä tilaa palvelimelle, voi palvelin myös erikseen pyytää sitä. Tilamuutokset 
lähetetään aina kaikkien kontaktien kaikille resursseille.

Tilanmuutospyyntö tehdään lähettämällä palvelimelle presence-säe. Tila ilmoitetaan säkeessä elementissä "show". Asiakas 
voi myös lähettää lisätietoja tilasta "status"-elementissä. Lisätietoelementissä voi olla pitempikin teksti, mutta tilaelementin
sisältö on yleensä lyhyt. 

\section{Muita protokollia}

XMPP-protokollan lisäksi on olemassa myös muita pikaviestinprotokollia, kuten muunmuassa MSNP, Skype, IRC, SIMPLE 
ja useita muita. Näistä SIMPLE suunniteltiin myös mahdollisimman yleiskäyttöiseksi ja avoimeksi, ja on käytössä 
esimerkiksi joissain VoIP-sovelluksissa. 

Skype-protokolla on täysin suljettu ja salattu ~\cite{skype1}. Protokollasta on onnistuttu selvittämään osia, mutta ainakin
toistaiseksi sen toiminta on suurilta osin tuntematon. Skype-verkko on rakenteeltaan hajautettu, mutta
verkkoon kirjautuminen pitää tehdä erillisen Skype Limited-yhtiön kirjautumispalvelimen kautta.

MSNP (Microsoft Notification Protocol) on Microsoft-yhtiön protokolla pikaviestintään. Sitä käytetään muunmuassa yhtiön 
omissa Windows Messenger, MSN Messenger ja Windows Live Messenger-sovelluksissa. Myös esimerkiksi avoimeen lähdekoodiin 
perustuvat pikaviestinsovellukset Pidgin ja Trillian taitavat viestinnän MSNP-protokollan yli. MSNP-verkko on rakenteeltaan 
keskitetty ~\cite{msnp}, ja kirjautumispalvelimet ovat Microsoftin hallinnassa. Microsoft ei julkaise protokollan määritelmää, vaan
jokainen protokollan versio on käyttäjien toimesta purettu ja määritelmät julkaistu epävirallisesti. Tällä hetkellä MSNP:n 
viimeisin julkaistu versio on 19, vaikka kirjautumispalvelimet tukevatkin kaikkia protokollia versiosta 8 lähtien.

IRC (Internet Relay Chat) on vuonna 1988 Suomessa kehitetty tekstipohjainen pikaviestinprotokolla. Protokolla on avoin, 
ja siitä on useita versioita sekä toteutuksia. Rakenteeltaan IRC on hajautettu. Palvelimet voidaan
yhdistää kokonaisuuksiksi eli keskusteluverkoiksi, joilla on nimi (mm. ircnet). Keskusteluverkossa
voi olla useita keskustelukanavia, joille voi liittyä ~\cite{ircrfc}. 

\section{XMPP-protokollan edut ja heikkoudet}

\subsection{Avoimuus}
XMPP-protokolla on täysin avoin, ja kuka tahansa voi käyttää sitä ilman maksuja millekään taholle. 

(vertaile avoimuutta muihin, jne)


\subsection{Hyötysuhde}

XML-pohjaisten protokollien heikkoutena on pakettien suuri koko ja suhteellisen pieni hyötysuhde. Viestipakettien koko voi
olla moninkertainen itse paketissa lähetettävään tietoon.

(tänne lisää tekstiä)

\begin{figure}[htp]
	\centering
	\includegraphics[width=0.9\textwidth]{viestipaketti_cmp.png}
	\caption{Viestipaketin koko eri protokollissa} 
	\label{viestipaketticmpkuva}
\end{figure}

\subsection{Suojaus}


\section{Yhteenveto}

XMPP on nykyään jo erittäin tuettu standardi, ja soveltuu hyvin erilaisiin pikaviestinnän
käyttötarkoituksiin. Vaikka protokollaa ei nykyään vielä tuetakaan monissa suurimmista
pikaviestinohjelmista, se leviää koko ajan pienempien palveluiden kautta. Protokollan 
suurin hyöty onkin sen ilmainen soveltaminen eri tarkoituksiin sekä hyvän määritelmän
kautta saavutettu yhteensopivuus valmiiden sovellusten kanssa. Myös muihin pikaviestintäverkkoihin
viestiminen on mahdollistettu siltapalvelinten avulla, joten verkon asteittainen päivittäminen
on suhteellisen yksinkertaista. Laajennettavan rakenteensa avulla XMPP-protokolla on valmistautunut
sopeutumaan myös tulevaisuuden pikaviestinnän luomiin vaatimuksiin.

(Hieman lyhyt vielä ...)
(Lisää liitteet!)

\begin{thebibliography}{99}

\bibitem{rfc3920}
P. Saint-Andre, 
\textit{"Extensible Messaging and Presence Protocol (XMPP): Core"},
Saatavilla osoitteesta <URL: \texttt{http://www.xmpp.org/rfcs/rfc3920.html}>,
lokakuu 2004, RFC-3920.

\bibitem{rfc3921}
P. Saint-Andre, 
\textit{"Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence"},
Saatavilla osoitteesta <URL: \texttt{http://www.xmpp.org/rfcs/rfc3921.html}>,
lokakuu 2004, RFC-3921.

\bibitem{rfc3922}
P. Saint-Andre, 
\textit{"Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM)"},
Saatavilla osoitteesta <URL: \texttt{http://tools.ietf.org/html/rfc3922}>,
lokakuu 2004, RFC-3922.

\bibitem{helxmpp}
Mikko Laukkanen,
\textit{"Extensible Messaging and Presence Protocol (XMPP)"},
Saatavilla osoitteesta <URL: \texttt{http://www.cs.helsinki.fi/u/kraatika/Courses/IPsem04s/xmpp.pdf}>, 
Helsingin yliopisto, viitattu 15.3.2008.

\bibitem{xep0166}
Scott Ludwig, Joe Beda, Peter Saint-Andre, Robert McQueen, Sean Egan ja Joe hildebrand, 
\textit{"XEP-0166: Jingle"},
Saatavilla osoitteesta <URL: \texttt{http://www.xmpp.org/extensions/xep-0166.html}>,
29.2.2008.

\bibitem{salin}
Peter Salin, 
\textit{"Mobile Instant Messaging Systems - A Comparative Study and Implementation"},
Saatavilla osoitteesta <URL: \texttt{http://www.tml.tkk.fi/anttiyj/Salin-IMPS.pdf}>,
Teknillinen korkeakoulu, 21.9.2004.

\bibitem{xmpporg1}
\textit{"Jabber Software Foundation Renamed to XMPP Standards Foundation"},
Saatavilla osoitteesta <URL: \texttt{http://www.xmpp.org/xsf/press/2007-01-16.shtml}>,
XMPP standards foundation, 16.1.2007, Denver, Yhdysvallat.

\bibitem{wiki1}
Wikipedia, 
\textit{"Instant messaging"},
Saatavilla osoitteesta <URL: \texttt{http://en.wikipedia.org/wiki/Instant\_messaging}>,
viitattu 27.11.2010.

\bibitem{skype1}
Salman A. Baset, Henning Schulzrinne,
\textit{"An Analysis of the Skype Peer-to-Peer Internet Telephony Protocol"},
Saatavilla osoitteesta <URL: \texttt{http://arxiv.org/pdf/cs/0412017}>,
Columbia University, New York, Yhdysvallat, 15.9.2004.

\bibitem{msnp}
MSNPiki, 
\textit{"MSN Protocol Version 8"},
Saatavilla osoitteesta <URL: \texttt{http://msnpiki.msnfanatic.com/index.php/Main\_Page}>,
viitattu 10.1.2011.

\bibitem{ircrfc}
Jarkko Oikarinen, Darren Reed,
\textit{"RFC1459 - Internet Relay Chat Protocol"},
Saatavilla osoitteesta <URL: \texttt{http://tools.ietf.org/html/rfc1459}>,
viitattu 31.10.2011

\bibitem{extxep}
Peter Saint-Andre,
\textit{"XEP-0001: XMPP Extension Protocols"}
Saatavilla osoitteesta <URL: \texttt{http://xmpp.org/extensions/xep-0001.pdf}>,
10.3.2010, XEP-0001.

\end{thebibliography}

\newpage
\pagestyle{empty}

\appendix

\section*{Liite 1. Yhteyden hallinta}
\addtocontents{toc}{
\protect \contentsline {section}{\hspace{0.5cm}1 Yhteyden hallinta}{}}

\begin{figure}[htp]
	\centering
	\includegraphics[scale=0.8]{yhteys.png}
	\caption{Yhteyden hallinta} 
	\label{yhteyskuva}
\end{figure}


\end{document}
