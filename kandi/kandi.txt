1. Johdanto

2. XMPP
  2.1. Versiot ja ydinstandardi
  2.2. Laajennukset

3. XMPP-Verkko
  3.1. Palvelin
  3.2. Asiakas
  3.3. Välipalvelin
  3.4. Autentikaatio
  3.5. XML-streamit

4. Laajennukset pikaviestintään
  4.1. Session aloitus
  4.2. Viestien välitys 
  4.3. Ystävälistan hallinta
  4.4. Yhteyksien kieltäminen
  4.5. Paikallaolotiedot

5. Salausmenetelmät
  5.1. Viestien salaus
  5.2. Paikallaolotiedon salaus
  5.3. Tiedon salaus välipalvelimen läpi

6. Toteutukset

7. Yhteenveto

Lähteet

Liitteet

A XML Stanza: Yhteyden muodostus

B XML Stanza: pikaviestin lähetys

C XML Stanza: paikallaolotiedon lähetys

-----------------

------------ TEE UUDELLEEN ------------
\begin{abstract}
XMPP on monipuolinen ja helposti laajennettava, avoimiin standardeihin perustuva pikaviestinprotokolla. 
Sitä voidaan käyttää paitsi puhtaiden tekstiviestien lähettämiseen ja läsnäolon tarkkailuun, myös 
esimerkiksi tiedostonsiirtoihin ja internet-puheluihin. Tässä tutkimuksessa tutustutaan protokollan 
teknisiin ominaisuuksiin sekä laajennettavuuteen ja tehdään vertailuja muihin toteutuksiin.
\end{abstract}


1. Johdanto 

Pikaviestinnästä on tullut osa useiden tietokoneen, ja vähitellen myös erilaisten mobiililaitteiden käyttäjien arkea. Erilaisia pikaviestimiä on useita, ja niillä on käytössä omat viestintäprotokollansa. Tästä johtuukin nykymallin mukaisen pikaviestinnän suurin ongelma: eri verkkoihin tarvitaan usein oma ohjelmansa. Joskus ongelmana on myös se, että pikaviestinverkkon protokolla on jollain tavalla suljettu tai salattu. Tämä tarkoittaa sitä, että niitä ei voida toteuttaa muihin pikaviestimiin ilman protokollan purkua.

XMPP-protokolla pyrkii tuomaan käyttöön yhtenäisen standardin yritysten ja yksityisten henkilöiden pikaviestintätarpeisiin. Aiemmin protokolla tunnettiin nimellä Jabber, kunnes Jabber Software Foundation luovutti protokollan Internet Engineering Task Force -organisaatiolle (IETF)~\cite{xmpporg1}. Nykyään protokollaa kehittääkin IETF:n muodostama työryhmä nimeltään XMPP Working Group. Kehityksessä protokolla on ollut vuodesta 1999 alkaen, jonka jälkeen siihen on tasaisesti luotu lisää laajennuksia, kuten Googlen Jingle-projekti~\cite{xep0166} multimedian siirtoon. XMPP:aa tukee tai käyttää pääasiallisena alustanaan jo monta tunnettua pikaviestintä, kuten Google Talk, Pidgin ja Kopete.

-----------------------------------------------

2. XMPP

Extensible Messaging and Presence Protocol (XMPP) on avoin, reaaliaikaiseen pikaviestintään ja olotilan ilmoittamiseen tarkoitettu XML-pohjainen standardi. Protokollaa kehittiin alun perin nimellä Jabber, ja se oli tarkoitettu saman nimiseen, vapaaseen lähdekoodiin perustuvaan pikaviestinohjelmaan. Vuonna 2002 perustettiin XMPP työryhmä (XMPP WG), jonka tehtäväksi tuli Jabber-protokollaan perustuvan pikaviestinprotokollan kehitys. Uuden, XMPP-nimisen protokollan tarkoitus oli soveltua Internet Engineering Task Forcen (IETF) tukemaksi pikaviestintä- ja olotilan hallinta-protokollaksi. Kehitystyön tuloksena oli lopulta dokumentti, jossa määriteltiin protokollan perusominaisuudet ja laajennukset pikaviestintään. Nykyään tätä perustoiminnallisuutta määritellään RFC-dokumenteissa RFC3920 ja 3921. Myöhemmin protokollaan on luotu laajennuksia esimerkiksi protokollan salaukseen sekä puheen välittämiseen. 

2.1. Versiot ja ydinstandardi

 - Versioista ja muutoksista

2.2. Laajennukset
 
 - Mitä laajennuksia, mitä tekevät ?

3. XMPP-verkko
3.1 Palvelin

Vaikka XMPP:n määritelmässä ei varsinaisesti määritellä miten viestejä lähetetään, käytetään protokollaa yleensä asiakas-palvelin-arkkitehtuurilla. Erona useisiin muihin tunnettuihin protokolliin, kuten OSCAR ja MSNP on kuitenkin se, että XMPP-verkolla ei ole yhtä keskitettyä autentikaatiopalvelinta. Käytännössä siis kuka tahansa voi ajaa omaa palvelintaan. 

Palvelimen tehtävänä XMPP-verkossa on TCP-yhteyksien vastaanotto sekä liikenteen välittäminen muille autentikoiduille käyttäjille, palvelimille ja muille kohteille. Palvelin myös reitittää asiakkaan lähettämät paketit oikeisiin kohteisiin. Palvelimet voivat myös tallentaa käyttäjäkohtaisia tietoja, kuten kontaktilistan, joka voi sisältää muita käyttäjiä mistä tahansa liitetystä XMPP-verkosta.

[kuva]

3.2. Asiakas

Asiakas luo yhteyden palvelimeen TCP-protokollan yli tiettyyn palvelimen porttiin. XMPP-protokollan käyttöön on määritelty IANA:n toimesta portti 5222, mutta muitakin saattaa olla käytössä. Asiakkaan tehtävänä on lähettää viestejä ja tilatietoja palvelimelle, sekä vastaanottaa niitä palvelimelta. Asiakkaan on osattava vähintään avata yhteys XML-viestien lähettämistä ja vastaanottamista varten.

XMPP-verkossa jokaista asiakasta tai päätepistettä kutsutaan entiteetiksi, jolla on aina oma tunnisteensa nimeltään JID. Tunniste on kolmiosainen, esimerkiksi muotoa "<solmu@toimialue/resurssi>". Tunnisteessa toimialue-kenttä määrittelee käytetyn palvelimen osoitteen, "solmu"-kenttä käyttäjän nimen ja resurssi-kenttä käyttäjälle kuuluvan toisen asiakaslaitteen. Protokolla salliikin useampien asiakasohjelmien kirjautumisen samalle palvelimelle samalla käyttäjätunnuksella, kunhan eri ohjelmille määritellään oma kotiosoitteensa. Resursseille voidaan määrittää myös tärkeystasoja, jolloin esimerkiksi osoitteeseen "<solmu@toimialue/matkapuhelin>" lähetetty viesti menee käyttäjän matkapuhelimeen, mutta osoitteeseen "<solmu@toimialue>" lähetetty viesti ohjautuu tärkeimmäksi määriteltyyn asiakasohjelmaan tai laitteeseen.

3.3. Välipalvelin

Koska XMPP-sallii useampien palvelinten toimimisen yhdessä, voidaan XMPP-verkkoa laajentaa niinsanotuilla välipalvelimilla (Gateway). Välipalvelimen tehtävänä on muuntaa XMPP-viestejä sopivaksi välipalvelimen toisella puolella toimivaan pikaviestinverkkoon, ja toisaalta toisesta verkosta tulevia viestejä XMPP-verkkoon sopiviksi. Tunnettuja välipalvelimia on olemassa esimerkiksi SMTP, Internet Relay Chat, SIMPLE sekä SMS -verkkoja varten. 

Suurimpana ongelmana välipalvelinten käytössä on se, että protokollat eivät aina ole täysin yhteensopivia. Tästä seuraa, että osa viesteissä välitetystä tiedosta ei välttämättä ole esitettävissä toisella protokollalla.

3.4. Autentikaatio
 - Miten käyttäjä autentikoituu palvelimelle
 - Miten varmistetaan muille palvelimille ?

3.5. XML-virrat

XMPP määrittelee viestien välitykseen kaksi käsitettä, jotka ovat XML-virrat (Streams) sekä säkeistöt (Stanza). XML-virta on säiliö, jota käytetään XML-elementtien kuljettamiseen verkkoentiteettien välillä. Virran alku ilmoitetaan aina merkkijonolla "<stream>", jossa voidaan määritellä myös esimerkiksi käytettävä nimiavaruus ja nerkistö. Virran loppua merkkaa vastakkaisesti merkkijono "</stream>". Niin kauan kuin XML-virta on olemassa, sen luonut entiteetti voi lähettää määrittämättömän määrän XML-elementtejä vastaanottajalle. 

Virrassa voidaan lähettää joko XML-säkeistöjä tai yhteyden neuvottelemiseen tarvittavia XML-elementtejä. Mikäli jompi kumpi entiteetti saa vääränmuotoisen paketin, se hylätään. Yhteyden ja virran neuvottelee yleensä asiakas- tai palvelinentiteetti vastaanottavaan entiteettiin, joka on yleensä palvelin. XML-virta on aina yksisuuntainen; mikäli vastaanottava pää haluaa lähettää viestejä, pitää sen tätä varten erikseen neuvotella erillinen virta (Response Stream).

XML-säkeistö on itsenäinen tietopaketti, joka voidaan lähettää entiteetiltä toiselle XML-virran yli. Stanza kuljetetaan aina suoraan XML-virran juurielementin ("<stream>") alla


 - Miltä protokollan viestit näyttävät, yleisrakenne!
 - Esimerkkejä ?
 - Voisi mainita jotain XML:n hyvistä ja huonoista puolista tässä.

4. Laajennukset pikaviestintään
4.1. Session aloitus
 - Miten aloitetaan pikaviestintä toisen henkilön kanssa ?
 - asiakas - palvelin - palvelin - asiakas
 - asiakas - palvelin - gateway - palvelin - asiakas

4.2. Viestien välitys
 - Miten viestit enkoodataan, laitetaan pakettiin ?
 - Rajoitukset ?

4.3. Ystävälistan hallinta
 - Miten pidetään yhteystietoja, lisätään

4.4. Yhteyksien kieltäminen
 - Yhteyksien blokkaaminen muilta käyttäjiltö

4.5. Paikallaolotiedot
 - Miten välitetään tiedot online- away- jne. tiloista

5. Salausmenetelmät
5.1. Viestien salaus
 - Miten viestit salataan
5.2. Paikallaolotietojan salaus
 - Miten olotiedot salataan
5.3. Välipalvelimen yli tietojen salaus
 - ...

6. Toteutukset
 - Mitä kaikkia toteutuksia XMPP-protokollasta on olemassa

------------ TEE UUDELLEEN ------------

7. Yhteenveto

Vaikka XMPP ei varsinaisesti vielä ole standardi, on sillä jo laaja tukijapohja. Protokollaa käytetään jo esimerkiksi Google Talk -pikaviestinohjelmassa, kuten myös linux-käyttäjien tuntemassa pidgin-ohjelmassa. Vaikka toistaiseksi yksikään suurista pikaviestinverkkoja ylläpitävistä yhtiöistä, kuten Microsoft ja Yahoo, eivät ole XMPP:tä käyttöön ottaneet, ovat nekin jo raottaneet pikaviestinohjelmiaan muille protokollille~\cite{ms1}. Suurempaa muutosta odotellessa on XMPP:aa käyttävien pikaviestimien silti helppo jutella näihin verkkoihin siltapalvelimien avulla. Koska XMPP on myös yksinkertaisesti laajennettavissa, on se helppo saada toimimaan tulevisuudenkin pikaviestinnän luomien vaatimusten kanssa. 

------------------------------------


A XML Stanza: Yhteyden muodostus

 - Dokumentti, jossa kuvataan yhteyden muodostus

B XML Stanza: pikaviestin lähetys

 - Dokumentti, jossa kuvataan pikaviestin lähetys

C XML Stanza: paikallaolotiedon lähetys
 
 - Dokumentti, jossa kuvataan paikallaolotiedon lähetys

